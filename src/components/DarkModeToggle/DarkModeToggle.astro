---
// src/components/ThemeToggle.astro
---

<!-- ---
// DarkModeToggle.astro
---

<button
  id="dark-mode-toggle"
  class="text-2xl p-2 rounded-full transition-all duration-300"
>
  <i id="theme-toggle-icon" class="fas fa-sun"></i>
</button>

<script is:inline>
  // Dark mode logic
  const darkModeToggle = document.getElementById("dark-mode-toggle");
  const themeToggleIcon = document.getElementById("theme-toggle-icon");

  // Check for saved 'darkMode' in localStorage
  const savedTheme = localStorage.getItem("darkMode");

  // Initial theme setup
  function setupInitialTheme() {
    const isDark =
      savedTheme === "dark" ||
      (!savedTheme &&
        window.matchMedia("(prefers-color-scheme: dark)").matches);

    document.documentElement.classList.toggle("dark", isDark);
    themeToggleIcon.classList.toggle("fa-moon", isDark);
    themeToggleIcon.classList.toggle("fa-sun", !isDark);
  }

  // Toggle dark mode
  function toggleDarkMode() {
    const isDark = document.documentElement.classList.toggle("dark");

    // Toggle icon
    themeToggleIcon.classList.toggle("fa-moon", isDark);
    themeToggleIcon.classList.toggle("fa-sun", !isDark);

    // Save preference in localStorage
    localStorage.setItem("darkMode", isDark ? "dark" : "light");
  }

  // Initial setup
  setupInitialTheme();

  // Add click event listener
  darkModeToggle.addEventListener("click", toggleDarkMode);

  // Handle system theme changes
  window
    .matchMedia("(prefers-color-scheme: dark)")
    .addEventListener("change", setupInitialTheme);
</script> -->
<button
  id="theme-toggle"
  class="p-2 rounded-full border border-gray-300 dark:border-gray-600 transition-colors"
>
  <i id="theme-icon" class="fas fa-moon"></i>
</button>

<script is:inline>
  const toggleButton = document.getElementById("theme-toggle");
  const icon = document.getElementById("theme-icon");

  const setTheme = (theme) => {
    if (theme === "dark") {
      document.documentElement.classList.add("dark");
      localStorage.setItem("theme", "dark");
      icon.classList.remove("fa-moon");
      icon.classList.add("fa-sun");
    } else {
      document.documentElement.classList.remove("dark");
      localStorage.setItem("theme", "light");
      icon.classList.remove("fa-sun");
      icon.classList.add("fa-moon");
    }
  };

  // SIEMPRE arranca en claro, a menos que el usuario haya guardado "dark"
  const storedTheme = localStorage.getItem("theme");
  if (storedTheme === "dark") {
    setTheme("dark");
  } else {
    setTheme("light");
  }

  toggleButton.addEventListener("click", () => {
    const isDark = document.documentElement.classList.contains("dark");
    setTheme(isDark ? "light" : "dark");
  });
</script>
